# =============================================================================
# Setup-Factory Configuration
# =============================================================================

# -----------------------------------------------------------------------------
# Application
# -----------------------------------------------------------------------------
NODE_ENV=development
API_PORT=3001
FRONTEND_PORT=3000
WORKER_CONCURRENCY=5

# -----------------------------------------------------------------------------
# Database (PostgreSQL)
# -----------------------------------------------------------------------------
DATABASE_URL=postgresql://setupfactory:setupfactory@localhost:5432/setupfactory
POSTGRES_USER=setupfactory
POSTGRES_PASSWORD=setupfactory
POSTGRES_DB=setupfactory

# -----------------------------------------------------------------------------
# Redis (Job Queue & Cache)
# -----------------------------------------------------------------------------
REDIS_URL=redis://localhost:6379
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=

# -----------------------------------------------------------------------------
# Bitbucket (Script Repository Sync)
# -----------------------------------------------------------------------------
BITBUCKET_URL=https://bitbucket.org/yourteam/automation-scripts.git
BITBUCKET_USERNAME=youruser
BITBUCKET_APP_PASSWORD=yourapppassword
# Alternative: OAuth Consumer Key/Secret
# BITBUCKET_OAUTH_KEY=
# BITBUCKET_OAUTH_SECRET=

# Bitbucket Webhook Secret (for signature verification)
BITBUCKET_WEBHOOK_SECRET=your-webhook-secret-here

# Local clone path for scripts repo
SCRIPTS_REPO_PATH=/var/lib/setup-factory/scripts

# Sync interval (cron expression, default: every 5 minutes)
SCRIPTS_SYNC_CRON=*/5 * * * *

# -----------------------------------------------------------------------------
# Jira Integration
# -----------------------------------------------------------------------------
JIRA_URL=https://yourcompany.atlassian.net
JIRA_USERNAME=youruser@yourcompany.com
JIRA_API_TOKEN=your-jira-api-token

# Default project for reproduction issues
JIRA_PROJECT_KEY=REPRO
JIRA_ISSUE_TYPE=Bug

# -----------------------------------------------------------------------------
# Authentication (Kerberos / SPNEGO)
# -----------------------------------------------------------------------------
# Kerberos realm and KDC
KRB5_REALM=CORP.YOURCOMPANY.COM
KRB5_KDC=kdc.corp.yourcompany.com

# Keytab for service principal (for API server)
KRB5_KEYTAB=/etc/krb5.keytab
SERVICE_PRINCIPAL=HTTP/setupfactory.corp.yourcompany.com@CORP.YOURCOMPANY.COM

# -----------------------------------------------------------------------------
# Authentication (OIDC Fallback)
# -----------------------------------------------------------------------------
OIDC_ENABLED=true
OIDC_ISSUER=https://login.microsoftonline.com/{tenant-id}/v2.0
OIDC_CLIENT_ID=your-client-id
OIDC_CLIENT_SECRET=your-client-secret
OIDC_REDIRECT_URI=http://localhost:3000/auth/callback

# -----------------------------------------------------------------------------
# Vault (Server-Run Credentials)
# -----------------------------------------------------------------------------
VAULT_ADDR=https://vault.corp.yourcompany.com
VAULT_TOKEN=your-vault-token
# Alternative: AppRole auth
# VAULT_ROLE_ID=
# VAULT_SECRET_ID=

# Path prefix for secrets in Vault
VAULT_SECRET_PATH=secret/setup-factory

# -----------------------------------------------------------------------------
# Agent Configuration
# -----------------------------------------------------------------------------
# Agent registration requires a shared secret
AGENT_REGISTRATION_SECRET=your-agent-secret-here

# Agent heartbeat timeout (seconds)
AGENT_HEARTBEAT_TIMEOUT=60

# -----------------------------------------------------------------------------
# Job Execution
# -----------------------------------------------------------------------------
# Default job timeout (seconds)
JOB_TIMEOUT=3600

# Maximum log size (bytes)
MAX_LOG_SIZE=10485760

# Artifact storage path
ARTIFACTS_PATH=/var/lib/setup-factory/artifacts

# Reproduction bundle storage path
BUNDLES_PATH=/var/lib/setup-factory/bundles

# -----------------------------------------------------------------------------
# Runner (Server-Run Mode)
# -----------------------------------------------------------------------------
# Docker socket for server-run containers
DOCKER_SOCKET=/var/run/docker.sock

# Default runner image
RUNNER_IMAGE=setup-factory/runner:latest

# Network for runner containers
RUNNER_NETWORK=setup-factory

# Cleanup ephemeral containers after execution
RUNNER_CLEANUP=true

# -----------------------------------------------------------------------------
# Security
# -----------------------------------------------------------------------------
# JWT secret for API tokens
JWT_SECRET=your-jwt-secret-here-change-in-production

# Session secret
SESSION_SECRET=your-session-secret-here-change-in-production

# CORS allowed origins (comma-separated)
CORS_ORIGINS=http://localhost:3000,http://localhost:3001

# Enable audit logging
AUDIT_ENABLED=true
AUDIT_LOG_PATH=/var/log/setup-factory/audit.log

# -----------------------------------------------------------------------------
# Logging
# -----------------------------------------------------------------------------
LOG_LEVEL=info
LOG_FORMAT=json

# -----------------------------------------------------------------------------
# Monitoring
# -----------------------------------------------------------------------------
# Prometheus metrics endpoint
METRICS_ENABLED=true
METRICS_PORT=9090
